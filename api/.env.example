# Coherence API — copy to .env
# See docs/API-KEYS-SETUP.md for details

# OpenRouter (free/low-cost models)
OPENROUTER_API_KEY=
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# OpenAI-compatible env (used by Cursor CLI for OpenRouter)
OPENAI_API_KEY=
OPENAI_API_BASE=https://openrouter.ai/api/v1

# Claude / Claude Code CLI
# Auth resolution order (first match wins):
#   1. ANTHROPIC_API_KEY          — cloud API key (separate billing from claude.ai subscription)
#   2. CLAUDE_CODE_OAUTH_TOKEN    — explicit OAuth token (advanced / CI use)
#   3. `claude login` session     — subscription billing; no env var needed (local use)
# ANTHROPIC_API_KEY=
# CLAUDE_CODE_OAUTH_TOKEN=     # Alternative: explicit OAuth token (see `claude setup-token`)
# CLAUDE_CODE_MODEL=            # Optional: model override for claude -p (default: uses claude's default)
# CLAUDE_CODE_COMMAND_TEMPLATE= # Optional: override full command template (must include {{direction}})

# OpenAI
# OPENAI_API_KEY=

# Ollama local (no key)
OLLAMA_BASE_URL=http://localhost:11434

# Telegram (alerts + webhook)
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_IDS=
TELEGRAM_ALLOWED_USER_IDS=

# Deployment verification retries (bounded de-risk window)
PUBLIC_DEPLOY_VERIFICATION_MAX_ATTEMPTS=8
PUBLIC_DEPLOY_VERIFICATION_RETRY_SECONDS=60
PUBLIC_DEPLOY_CONTRACT_BLOCK_THRESHOLD_SECONDS=600

# Paid-provider window governance (leave room for other tasks)
# Set usage limits for your provider quotas and keep work below this fraction (default 33%).
PAID_TOOL_8H_LIMIT=300
PAID_TOOL_WEEK_LIMIT=2200
PAID_TOOL_WINDOW_BUDGET_FRACTION=0.333
# Provider quota guard (automatic per-provider hourly/weekly/monthly remaining checks)
AUTOMATION_PROVIDER_WINDOW_GUARD_ENABLED=1
AUTOMATION_PROVIDER_MIN_REMAINING_RATIO_HOURLY=0.1
AUTOMATION_PROVIDER_MIN_REMAINING_RATIO_WEEKLY=0.1
AUTOMATION_PROVIDER_MIN_REMAINING_RATIO_MONTHLY=0.1
# Optional strict mode: block paid execution when required/active providers have no remaining telemetry.
# AUTOMATION_PROVIDER_WINDOW_GUARD_BLOCK_ON_MISSING_LIMITS=1
# Optional provider-specific overrides (JSON). Example:
# AUTOMATION_PROVIDER_WINDOW_GUARD_POLICY_JSON={"default":{"hourly":0.1,"weekly":0.1,"monthly":0.1},"openai":{"weekly":0.05},"github":{"monthly":0.2}}

# Database
# NEO4J_URI=bolt://localhost:7687
# NEO4J_USER=neo4j
# NEO4J_PASSWORD=
# DATABASE_URL=postgresql://user:pass@localhost:5432/coherence

# Agent executor: Cursor CLI by default; set to "claude" for Claude Code CLI
AGENT_EXECUTOR_DEFAULT=cursor
CURSOR_CLI_MODEL=auto
CURSOR_CLI_REVIEW_MODEL=auto
# Optional Cursor subscription window limits (used for proactive backoff before hard caps)
# CURSOR_SUBSCRIPTION_8H_LIMIT=225
# CURSOR_SUBSCRIPTION_WEEK_LIMIT=1200

# Claude Code CLI executor (AGENT_EXECUTOR_DEFAULT=claude or escalation target)
# Requires: npm install -g @anthropic-ai/claude-code
# Auth: run `claude login` for local use (subscription), or set ANTHROPIC_API_KEY for CI/cloud.
# AGENT_EXECUTOR_DEFAULT=claude
# AGENT_EXECUTOR_ESCALATE_TO=claude

# Ollama (local open-source models, no Anthropic auth required)
# OLLAMA_MODEL=qwen3-coder:30b
OLLAMA_MODEL=glm-4.7-flash:q8_0
# ANTHROPIC_AUTH_TOKEN=ollama
# ANTHROPIC_BASE_URL=http://localhost:11434

# Web runtime
NEXT_PUBLIC_API_URL=http://localhost:8000

# API CORS (comma-separated list)
# Local development:
ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
# Production (add your Railway web domain):
# ALLOWED_ORIGINS=https://coherence-web-production.up.railway.app,http://localhost:3000
